(window.__LOADABLE_LOADED_CHUNKS__=window.__LOADABLE_LOADED_CHUNKS__||[]).push([[25],{1088:function(e,t,n){"use strict";n.r(t),n.d(t,"SlQuizComments",(function(){return je}));var a=n(92),r=n(1),o=n.n(r),c=n(550),i=n(548),l=n(713),s=n(714),m=n(156),u=n(907),d=n(1092),p=n(158),f=n(1091),v=n(1094),b=n(549),h=n(1097),g=n(1095),y=n(572),C=n(575),S=n(151);var _=function(e){if(Array.isArray(e))return e};var E=function(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var n=[],a=!0,r=!1,o=void 0;try{for(var c,i=e[Symbol.iterator]();!(a=(c=i.next()).done)&&(n.push(c.value),!t||n.length!==t);a=!0);}catch(e){r=!0,o=e}finally{try{a||null==i.return||i.return()}finally{if(r)throw o}}return n}};var O=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a};var j=function(e,t){if(e){if("string"==typeof e)return O(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?O(e,t):void 0}};var x=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")};var k=function(e,t){return _(e)||E(e,t)||j(e,t)||x()},I={id:"mf_slComments_container_context"};var w=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e};var z,q=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")};!function(e){e.hideComments="hideComments",e.filterChange="filterChange",e.getData="getData",e.resetVote="resetVote",e.downVote="downVote",e.upVote="upVote",e.deleteComment="deleteComment",e.addQuizComment="addQuizComment",e.loadMore="loadMore",e.toggleReplies="toggleReplies",e.replyComment="replyComment",e.editComment="editComment",e.updateComment="updateComment",e.openDeleteConfirmationModal="openDeleteConfirmationModal"}(z||(z={}));var N=function(e){if(Array.isArray(e))return O(e)};var T=function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)};var Q=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")};var A,M,D=function(e){return N(e)||T(e)||j(e)||Q()},R=Object(a.d)()(A=function e(){q(this,e),w(this,"trackAction",new c.a(null)),w(this,"trackActionStream",this.trackAction.pipe(Object(u.a)((function(e){return!!e})),Object(d.a)((function(e){slTrack({action:e.action,element:e.element,entityId:e.entityId||null,redirectUrl:e.redirectUrl||null})}))))})||A,L=function(e,t,n,a){return e.map((function(e){return e[t]===n?a:e}))},F=Object(a.d)()(M=function e(){q(this,e),w(this,"selectedFilter",new c.a(null)),w(this,"quizComments",new c.a(null)),w(this,"commentsCount",new c.a(null)),w(this,"loadCount",new c.a(20)),w(this,"pagingIndexes",new c.a({})),w(this,"postedComments",new c.a([])),w(this,"commentStates",new c.a({})),w(this,"loadingState",new c.a({loadingState:null})),w(this,"hasMoreComments",new c.a(null)),w(this,"globalError",new c.a(null)),w(this,"selectedCommentId",new c.a(null))})||M;function V(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var U,P,H,B,K=function(e,t,n){return t&&V(e.prototype,t),n&&V(e,n),e},W=Object(a.d)()(U=function(){function e(){q(this,e),w(this,"api",void 0),w(this,"quizId",void 0),this.api=new y.i({environmentUrl:a.b.take(I,"commentsApiHost"),useMock:a.b.take(I,"useMock"),mock:a.b.take(I,"mock")}),this.quizId=a.b.take(I,"quizId")}return K(e,[{key:"getQuizComments",value:function(e){return this.api.getQuizComments(this.quizId,e)}},{key:"getQuizCommentsCount",value:function(e){return this.api.getQuizCommentsCount(this.quizId,{type:e})}},{key:"deleteQuizComment",value:function(e){return this.api.deleteQuizComment(this.quizId,e)}},{key:"addQuizComment",value:function(e){return this.api.writeQuizComment(this.quizId,e)}},{key:"voteQuizComment",value:function(e,t){return this.api.voteQuizComment(this.quizId,e,t)}},{key:"updateQuizComment",value:function(e,t){return this.api.editQuizComment(this.quizId,e,t)}}]),e}())||U,$=Object(a.d)()(P=function e(){var t=this;q(this,e),w(this,"api",a.b.take(I,W)),w(this,"dataService",a.b.take(I,F)),w(this,"trackAction",a.b.take(I,R).trackAction),w(this,"isFirstLoading",!0),w(this,"getCommentsQuery",(function(e){return{count:t.dataService.loadCount.value,index:e?t.dataService.pagingIndexes.value[e]||0:t.dataService.pagingIndexes.value.main||0,type:a.b.take(I,"type"),parentId:e||null,orderby:t.dataService.selectedFilter.value}})),w(this,"updateIndex",(function(e,n,a){var r=n||"main",o=t.dataService.pagingIndexes.value;t.dataService.pagingIndexes.next(Object.assign({},o,w({},r,"number"==typeof a?a:(o[r]||0)+e)))})),w(this,"updateCommentState",(function(e,n){t.dataService.commentStates.next(Object.assign({},t.dataService.commentStates.value,w({},e,Object.assign({},t.dataService.commentStates.value[e],n))))})),w(this,"udpateChildren",(function(e,n){var a=t.dataService.commentStates.value[n];t.updateIndex(e.length,n),a.children?t.updateCommentState(n,{isLoading:!1,focusReplyBox:!1,children:[].concat(D(a.children),D(e)),hasMore:e.length===t.dataService.loadCount.value}):t.updateCommentState(n,{children:e,isLoading:!1,focusReplyBox:!1,hasMore:e.length===t.dataService.loadCount.value})})),w(this,"updateComments",(function(e){t.dataService.loadingState.next({loadingState:null}),t.dataService.hasMoreComments.next(e.length===t.dataService.loadCount.value),t.updateIndex(e.length);var n=t.dataService.quizComments.value||[];t.dataService.quizComments.next([].concat(D(n),D(e)))})),w(this,"handleErrors",(function(e,n){t.dataService.loadingState.next({loadingState:null}),e&&e.length&&"global"===n&&t.dataService.globalError.next("Oops, Something went wrong.")})),w(this,"getCommentType",(function(e,n){return n?t.dataService.commentStates.value[n].replies&&t.dataService.commentStates.value[n].replies.find((function(t){return t.id===e}))?"reply":"child":t.dataService.postedComments.value&&t.dataService.postedComments.value.find((function(t){return t.id===e}))?"posted":"main"})),w(this,"getQuizComments",(function(e){if(t.dataService.globalError.next(null),e)t.updateCommentState(e,{isThreadOpen:!0,isLoading:!0});else{var n,r=null!==(n=t.dataService.quizComments.value)&&void 0!==n&&n.length?"loadMore":"global";t.dataService.loadingState.next({loadingState:r})}return t.api.getQuizComments(t.getCommentsQuery(e)).pipe(Object(p.a)((function(e){return e.data})),Object(d.a)((function(n){e?t.udpateChildren(n,e):t.updateComments(n),t.isFirstLoading&&(t.trackAction.next({action:"view",element:a.b.take(I,"type")===y.r.descriptionComments?"comments_description":"comments_question",entityId:a.b.take(I,"quizId")}),t.isFirstLoading=!1)})),Object(f.a)((function(e){return t.handleErrors(e,"global"),Object(i.a)(null)})))})),w(this,"toggleReplies",(function(e){var n=t.dataService.commentStates.value[e]||{};return n.isThreadOpen?(n.replies&&t.updateIndex(0,e,0),t.updateCommentState(e,{isThreadOpen:!1,isLoading:!1,focusReplyBox:!1,replies:[],children:n.replies?[]:n.children}),Object(i.a)(null)):n.children&&n.children.length?(t.updateCommentState(e,{isThreadOpen:!0,focusReplyBox:!1}),Object(i.a)(null)):t.getQuizComments(e)})),w(this,"replyComment",(function(e,n,a){return n?t.updateCommentState(n,{focusReplyBox:!0}):t.updateCommentState(e,{isThreadOpen:!0,hasMore:!1,focusReplyBox:!0}),Object(i.a)(null)})),w(this,"getMainCommentsAndCount",(function(e){return t.dataService.quizComments.next(null),t.dataService.hasMoreComments.next(!1),Object(l.a)([t.getQuizComments(null),"number"==typeof e?Object(i.a)(e).pipe(Object(d.a)((function(e){return t.dataService.commentsCount.next(e)}))):t.api.getQuizCommentsCount(a.b.take(I,"type")).pipe(Object(d.a)((function(e){t.dataService.commentsCount.next(e.data)})),Object(f.a)((function(e){return t.handleErrors(e,"global"),Object(i.a)(null)})))])})),w(this,"voteQuizComment",(function(e,n){return t.api.voteQuizComment(e,n).pipe(Object(p.a)((function(e){return e.data})),Object(f.a)((function(e){return t.handleErrors(e,"global"),Object(i.a)(null)})))})),w(this,"openDeleteConfirmation",(function(e){return t.dataService.selectedCommentId.next(e),a.b.take("global",a.c).open("SlCommentConfirmDelete"),Object(i.a)(null)})),w(this,"deleteQuizComment",(function(e){return t.api.deleteQuizComment(e).pipe(Object(p.a)((function(e){return e.data})),Object(d.a)((function(){t.updateCommentState(e,{isDeleted:!0})})),Object(f.a)((function(e){return t.handleErrors(e,"global"),Object(i.a)(null)})))})),w(this,"editQuizComment",(function(e){return t.updateCommentState(e,{isEditing:!0}),Object(i.a)(null)})),w(this,"updateQuizComment",(function(e,n){return t.api.updateQuizComment(n,e).pipe(Object(p.a)((function(e){return e.data})),Object(d.a)((function(e){t.updateCommentState(n,{isEditing:!1});var a=t.getCommentType(e.id,e.parentId),r={main:function(){return L(t.dataService.quizComments.value,"id",e.id,e)},posted:function(){return L(t.dataService.postedComments.value,"id",e.id,e)},child:function(){return L(t.dataService.commentStates.value[e.parentId].children,"id",e.id,e)},reply:function(){return L(t.dataService.commentStates.value[e.parentId].replies,"id",e.id,e)}}[a]();"main"===a||"posted"===a?("main"===a?t.dataService.quizComments:t.dataService.postedComments).next(r):t.updateCommentState(e.parentId,w({},"child"===a?"children":"replies",r))})),Object(f.a)((function(e){return t.handleErrors(e,"global"),Object(i.a)(null)})))})),w(this,"addQuizComment",(function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return e.trim()?t.api.addQuizComment({parentId:n,type:a.b.take(I,"type"),message:e.trim()}).pipe(Object(p.a)((function(e){return e.data})),Object(d.a)((function(e){if(n){var a=t.dataService.commentStates.value[n].replies||[];t.updateCommentState(n,{replies:[].concat(D(a),[e])})}else t.dataService.postedComments.next([e].concat(D(t.dataService.postedComments.value)));t.trackAction.next({action:"write",element:n?"comments_reply":"comments_write",entityId:null})})),Object(f.a)((function(e){return t.handleErrors(e,"global"),Object(i.a)(null)}))):null}))})||P,Y=Object(a.d)()(H=function e(){var t=this;q(this,e),w(this,"handlers",a.b.take(I,$)),w(this,"dataService",a.b.take(I,F)),w(this,"actions",new c.a(null)),w(this,"cancelable",this.actions.pipe(Object(u.a)((function(e){return e&&"cancelable"===e.requestType})),Object(v.a)((function(e){switch(e.type){case z.hideComments:return a.b.take(I,"hideComments")(),Object(i.a)(null);case z.filterChange:var n=null===t.dataService.selectedFilter.value;return t.dataService.selectedFilter.value===e.filter||(t.dataService.selectedFilter.next(e.filter),n)?Object(i.a)(null):(t.dataService.pagingIndexes.next({}),t.dataService.postedComments.next([]),t.dataService.commentStates.next({}),t.handlers.getMainCommentsAndCount(t.dataService.commentsCount.value));case z.getData:return t.handlers.getMainCommentsAndCount(e.commentsCount);case z.loadMore:return t.handlers.getQuizComments(e.parentId);case z.openDeleteConfirmationModal:return t.handlers.openDeleteConfirmation(e.commentId);default:return Object(i.a)(e)}})))),w(this,"parallel",this.actions.pipe(Object(u.a)((function(e){return e&&"parallel"===e.requestType})),Object(b.a)((function(e){switch(e.type){case z.replyComment:return t.handlers.replyComment(e.commentId,e.parentId,e.commentType);case z.toggleReplies:return t.handlers.toggleReplies(e.commentId);case z.deleteComment:return t.handlers.deleteQuizComment(e.commentId);case z.editComment:return t.handlers.editQuizComment(e.commentId);case z.addQuizComment:return t.handlers.addQuizComment(e.message,e.parentId);case z.updateComment:return t.handlers.updateQuizComment(e.message,e.commentId);default:return Object(i.a)(e)}})))),w(this,"sequential",this.actions.pipe(Object(u.a)((function(e){return e&&"sequential"===e.requestType})),Object(h.a)((function(e){var n;switch(e.type){case z.resetVote:case z.upVote:case z.downVote:return t.handlers.voteQuizComment(e.commentId,(n={},w(n,z.resetVote,y.h.none),w(n,z.downVote,y.h.downvoted),w(n,z.upVote,y.h.upvoted),n)[e.type]);default:return Object(i.a)(e)}})))),w(this,"actionsStream",Object(s.a)(this.cancelable,this.parallel,this.sequential).pipe(Object(u.a)((function(e){return!!e}))))})||H,Z=(w(B={},y.g.MostUpvoted,"Popular"),w(B,y.g.Recent,"Recent"),B),G=o.a.memo((function(e){var t=e.filters,n=e.selectedFilter,c=Object(r.useState)(n),i=k(c,2),l=i[0],s=i[1],m=a.b.take(I,Y).actions;return o.a.createElement("div",{className:"sl-quiz-comment-filters"},t.map((function(e){return o.a.createElement("div",{key:e,className:"sl-quiz-comment-filters__filter ".concat(e===l?"sl-quiz-comment-filters__filter--active":""),onClick:function(){!function(e){m.next({type:z.filterChange,filter:e,requestType:"cancelable"}),s(e)}(e)}},Z[e])})))})),J={reply:"Write a reply...",comment:"Write a comment..."},X={reply:36,comment:64,edit:36},ee=o.a.memo((function(e){var t=e.onSubmit,n=e.state,a=e.type,c=Object(r.useRef)(null),i=Object(r.useRef)(),l=Object(r.useState)(""),s=k(l,2),m=s[0],u=s[1],d=Object(r.useState)("".concat(X[a],"px")),p=k(d,2),f=p[0],v=p[1],b=Object(r.useState)("".concat(X[a],"px")),h=k(b,2),g=h[0],y=h[1],C=Object(r.useState)(!1),S=k(C,2),_=S[0],E=S[1];Object(r.useEffect)((function(){return n&&(n.reset?w("string"==typeof n.text?n.text:""):"string"==typeof n.text&&u(n.text.trim()),n.focus&&setTimeout((function(){c.current.focus()}),0)),function(){document.removeEventListener("click",x)}}),[n]);var O=function(e){return e>X[a]?e:X[a]},j=function(){v("".concat(O(c.current.scrollHeight),"px")),y("".concat(O(c.current.scrollHeight),"px"))},x=function(e){i.current&&!i.current.contains(e.target)&&w()},I=function(){m.trim()&&t(m.trim())},w=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;document.removeEventListener("click",x),c.current.blur(),E(!1),u(null===e?c.current.value.trim():e),j()};return o.a.createElement("div",{ref:i,style:{minHeight:g}},o.a.createElement("textarea",{style:{height:f},placeholder:J[a],value:m.toString(),ref:c,rows:1,className:"sl-comment-textarea ".concat(_?"sl-comment-textarea--regular":"sl-comment-textarea--rounded"," ").concat("edit"===a?"sl-comment-textarea--edit":""),onChange:function(e){u(e.target.value),j()},onFocus:function(){E(!0),document.addEventListener("click",x)},onKeyPress:function(e){"enter"!==e.key.toLowerCase()||e.shiftKey||e.ctrlKey||e.altKey||(I(),e.preventDefault())}}),_&&o.a.createElement("div",{className:"sl-comment-textarea__footer ".concat("edit"===a?"sl-comment-textarea__footer--edit":"")},o.a.createElement("button",{className:"sl-comment-textarea__button",onClick:I},"Post")))})),te=o.a.memo((function(){var e=a.b.take(I,Y).actions,t=a.b.take(I,F).postedComments,n=Object(r.useState)(null),c=k(n,2),i=c[0],l=c[1],s=new m.a;Object(r.useEffect)((function(){return t.pipe(Object(u.a)((function(e){return!(!e||!e.length)})),Object(d.a)((function(){l({reset:!0})})),Object(g.a)(s)).subscribe(),function(){s.next(),s.complete()}}),[]);return o.a.createElement("div",{className:"sl-quiz-comment-input"},o.a.createElement(ee,{type:"comment",onSubmit:function(t){e.next({type:z.addQuizComment,requestType:"parallel",message:t,parentId:null})},state:i}))})),ne=o.a.memo((function(e){var t=e.avatarUrl,n=e.userId,a=Object(r.useState)(!!t),c=k(a,2),i=c[0],l=c[1];return o.a.createElement("a",{className:"sl-comment-avatar",href:"/Profile/".concat(n),target:"_blank"},i&&o.a.createElement("img",{src:t,onError:function(){l(!1)},alt:""}),!i&&o.a.createElement(S.a,{iconId:"profile"}))})),ae=o.a.memo((function(e){var t=e.date,n=e.replies,c=e.votes,i=e.vote,l=e.commentId,s=e.hideReplies,m=e.parentId,u=e.commentType,d=Object(r.useState)(i),p=k(d,2),f=p[0],v=p[1],b=Object(r.useState)(c),h=k(b,2),g=h[0],C=h[1],_=a.b.take(I,Y).actions;return o.a.createElement("div",{className:"sl-user-comment-footer"},o.a.createElement("div",{className:"sl-user-comment-footer__voting"},o.a.createElement("div",{className:"sl-user-comment-footer__upvote",onClick:function(){if(f!==y.h.upvoted){if(f===y.h.downvoted)return _.next({type:z.resetVote,commentId:l,requestType:"sequential"}),v(y.h.none),void C(g+1);_.next({type:z.upVote,commentId:l,requestType:"sequential"}),C(g+1),v(y.h.upvoted)}}},f!==y.h.upvoted&&o.a.createElement(S.a,{iconId:"caret-down"})),o.a.createElement("span",{className:"sl-user-comment-footer__vote-count ".concat(f===y.h.downvoted&&"sl-user-comment-footer__vote-count--negative"," ").concat(f===y.h.upvoted&&"sl-user-comment-footer__vote-count--positive")},g>0?"+".concat(g):g),o.a.createElement("div",{className:"sl-user-comment-footer__downvote",onClick:function(){if(f!==y.h.downvoted){if(f===y.h.upvoted)return _.next({type:z.resetVote,commentId:l,requestType:"sequential"}),v(y.h.none),void C(g-1);_.next({type:z.downVote,commentId:l,requestType:"sequential"}),C(g-1),v(y.h.downvoted)}}},f!==y.h.downvoted&&o.a.createElement(S.a,{iconId:"caret-down"}))),o.a.createElement("span",{onClick:function(){_.next({type:z.replyComment,commentId:l,parentId:m,requestType:"parallel",commentType:u})},className:"sl-user-comment-footer__reply"},"Reply"),n>0&&!s&&o.a.createElement("span",{onClick:function(){_.next({type:z.toggleReplies,commentId:l,requestType:"parallel"})},className:"sl-user-comment-footer__replies"},n," ",1===n?"reply":"replies"),o.a.createElement("span",{className:"sl-user-comment-footer__date"},function(e){var t=new Date,n=new Date(e),a=t.getFullYear()-n.getFullYear();if(a)return"".concat(a," year").concat(1===a?"":"s");var r=t.getMonth()-n.getMonth();if(r)return"".concat(r," month").concat(1===r?"":"s");var o=t.getDate()-n.getDate();return o?"".concat(o," day").concat(1===o?"":"s"):"Today"}(t)))}));function re(e,t){return e(t={exports:{}},t.exports),t.exports}var oe=re((function(e){function t(n){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?e.exports=t=function(e){return typeof e}:e.exports=t=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(n)}e.exports=t})),ce=re((function(e){function t(n,a){return e.exports=t=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},t(n,a)}e.exports=t}));var ie=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ce(e,t)},le=re((function(e){function t(n){return e.exports=t=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},t(n)}e.exports=t}));var se=function(e){return-1!==Function.toString.call(e).indexOf("[native code]")};var me=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}},ue=re((function(e){function t(n,a,r){return me()?e.exports=t=Reflect.construct:e.exports=t=function(e,t,n){var a=[null];a.push.apply(a,t);var r=new(Function.bind.apply(e,a));return n&&ce(r,n.prototype),r},t.apply(null,arguments)}e.exports=t})),de=re((function(e){function t(n){var a="function"==typeof Map?new Map:void 0;return e.exports=t=function(e){if(null===e||!se(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==a){if(a.has(e))return a.get(e);a.set(e,t)}function t(){return ue(e,arguments,le(this).constructor)}return t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),ce(t,e)},t(n)}e.exports=t}));function pe(e,t){pe=function(e,t){return new o(e,void 0,t)};var n=de(RegExp),a=RegExp.prototype,r=new WeakMap;function o(e,t,a){var o=n.call(this,e,t);return r.set(o,a||r.get(e)),o}function c(e,t){var n=r.get(t);return Object.keys(n).reduce((function(t,a){return t[a]=e[n[a]],t}),Object.create(null))}return ie(o,n),o.prototype.exec=function(e){var t=a.exec.call(this,e);return t&&(t.groups=c(t,this)),t},o.prototype[Symbol.replace]=function(e,t){if("string"==typeof t){var n=r.get(this);return a[Symbol.replace].call(this,e,t.replace(/\$<([^>]+)>/g,(function(e,t){return"$"+n[t]})))}if("function"==typeof t){var o=this;return a[Symbol.replace].call(this,e,(function(){var e=[];return e.push.apply(e,arguments),"object"!==oe(e[e.length-1])&&e.push(c(e,o)),t.apply(this,e)}))}return a[Symbol.replace].call(this,e,t)},pe.apply(this,arguments)}var fe=o.a.memo((function(e){var t=e.message,n=/((https?:\/\/)?(www\.)?[-a-zA-Z0-9@:%._\+()~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.()~#?&//=]*))/gi,a=pe(/\[user[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]id=(.*?)\](.*?)(\[\/user\])/g,{userid:1,username:2}),r=function(e){var t=a.exec(e);return t?e.replace(a,c(t.groups.userid.replace(/"/g,""),t.groups.username)):e},c=function(e,t){return"<a class=\"sl-user-comment-message__link\" target='_blank' href=".concat("/Profile/"+e,">").concat(t,"</a>")};return o.a.createElement("div",{className:"sl-user-comment-message",dangerouslySetInnerHTML:{__html:r(t).replace(n,(function(e,t){var n=t;if(0!==t.indexOf("http")){if(0!==t.indexOf("www"))return t;n="http://"+n}return"<a href="+n+' target="_blank" class="sl-user-comment-message__link">'+t+"</a>"}))}})})),ve=o.a.memo((function(e){var t=e.commentId,n=a.b.take(I,Y).actions,c=Object(r.useRef)(null),i=Object(r.useState)(!1),l=k(i,2),s=l[0],m=l[1],u=function(e){c.current&&!c.current.contains(e.target)&&p()},d=function(e){m(!0),document.addEventListener("click",u)},p=function(){m(!1),document.removeEventListener("click",u)};return Object(r.useEffect)((function(){return function(){document.removeEventListener("click",u)}}),[]),o.a.createElement("div",{ref:c,className:"sl-comment-options"},o.a.createElement("div",{onClick:function(e){s?p():d()},className:"sl-comment-options__dots"},o.a.createElement("div",{className:"sl-comment-options__dot"},o.a.createElement(S.a,{iconId:"three-dots"}))),s&&o.a.createElement("div",{className:"sl-comment-options__menu"},o.a.createElement("div",{onClick:function(e){e.stopPropagation(),p(),n.next({type:z.editComment,commentId:t,requestType:"parallel"})},className:"sl-comment-options__menu-item"},"Edit"),o.a.createElement("div",{onClick:function(e){e.stopPropagation(),p(),n.next({type:z.openDeleteConfirmationModal,requestType:"cancelable",commentId:t})},className:"sl-comment-options__menu-item"},"Delete"),o.a.createElement("div",{className:"sl-comment-options__arrow"})))})),be=o.a.memo((function(e){var t=e.parentId,n=Object(r.useState)(null),c=k(n,2),i=c[0],l=c[1],s=a.b.take("global",a.a),m=a.b.take(I,Y).actions;return o.a.createElement("div",{className:"sl-comment-reply-box"},o.a.createElement("div",{className:"sl-comment-reply-box__left"},o.a.createElement(ne,{userId:s.getUser().id,avatarUrl:s.getUser().avatarUrl})),o.a.createElement("div",{className:"sl-comment-reply-box__right"},o.a.createElement(ee,{type:"reply",onSubmit:function(e){m.next({type:z.addQuizComment,requestType:"parallel",message:e,parentId:t}),l({reset:!0})},state:i})))})),he=o.a.memo((function(e){var t=e.parentId,n=a.b.take(I,Y).actions;return o.a.createElement("div",{onClick:function(){n.next({type:z.loadMore,requestType:"cancelable",parentId:t})},className:"sl-comments-load-more"},"Load More")})),ge=o.a.memo((function(e){var t=e.comment,n=e.state,a=Object(r.useRef)();return Object(r.useEffect)((function(){n.focusReplyBox?(a.current.scrollIntoView({behavior:"smooth",block:"center"}),a.current.querySelector("textarea").focus()):a.current.querySelector("textarea").blur()}),[n]),o.a.createElement("div",{className:"sl-comment-thread"},n.children&&n.children.length?o.a.createElement(Ce,{comments:n.children,commentsType:"children"}):null,n.isLoading?o.a.createElement("div",{className:"sl-comment-thread__loading"},o.a.createElement(C.g,null)):null,n.hasMore?o.a.createElement("div",{className:"sl-comment-thread__load-more"},o.a.createElement(he,{parentId:t.id})):null,n.replies&&n.replies.length?o.a.createElement(Ce,{comments:n.replies,commentsType:"replies"}):null,o.a.createElement("div",{ref:a,className:"sl-comment-thread__reply"},o.a.createElement(be,{parentId:t.id})))})),ye=o.a.memo((function(e){var t=e.comment,n=e.isNewComment,c=a.b.take("global",a.a).getUser(),i=a.b.take(I,Y).actions,l=a.b.take(I,F).commentStates,s=Object(r.useState)(l.value[t.id]||{}),u=k(s,2),p=u[0],f=u[1],v=new m.a;Object(r.useEffect)((function(){return l.pipe(Object(g.a)(v),Object(d.a)((function(e){e[t.id]&&e[t.id]!==p&&f(e[t.id])}))).subscribe(),function(){v.next(),v.complete()}}),[]);return p.isDeleted?null:o.a.createElement("div",{className:"sl-user-comment"},o.a.createElement("div",{className:"sl-user-comment__main"},o.a.createElement("div",{className:"sl-user-comment__left"},o.a.createElement(ne,{avatarUrl:t.avatarUrl,userId:t.userId})),o.a.createElement("div",{className:"sl-user-comment__right"},c.id===t.userId&&o.a.createElement("div",{className:"sl-user-comment__options"},o.a.createElement(ve,{commentId:t.id})),o.a.createElement("div",{className:"sl-user-comment__message ".concat(n?"sl-user-comment__message--highlighted":"")},o.a.createElement("h5",{className:"sl-user-comment__user-name"},t.userName),p.isEditing?null:o.a.createElement(fe,{message:t.message}),p.isEditing?o.a.createElement(ee,{onSubmit:function(e){i.next({type:z.updateComment,requestType:"parallel",message:e,commentId:t.id})},state:{reset:!1,text:t.message,focus:!0},type:"edit"}):null),o.a.createElement(ae,{commentId:t.id,parentId:t.parentId,votes:t.votes,vote:t.vote,replies:t.replies,date:t.date,hideReplies:!!t.parentId,commentType:n?"new":"existing"}))),p.isThreadOpen&&o.a.createElement("div",{className:"sl-user-comment__thread"},o.a.createElement(ge,{comment:t,state:p})))})),Ce=o.a.memo((function(e){var t=e.comments,n=e.commentsType;Object(r.useEffect)((function(){}),[t]);var a=function(e){return("new"===n||"replies"===n)&&e===("new"===n?0:t.length-1)};return o.a.createElement("div",{className:"sl-quiz-comments-list"},t&&t.map((function(e,t){return o.a.createElement(ye,{key:e.id,comment:e,isNewComment:a(t)})})))})),Se=o.a.memo((function(){var e=Object(r.useState)(null),t=k(e,2),n=t[0],c=t[1],i=a.b.take(I,F).commentsCount,l=a.b.take(I,Y).actions,s=new m.a;return Object(r.useEffect)((function(){return i.pipe(Object(u.a)((function(e){return!!e||0===e})),Object(g.a)(s),Object(d.a)((function(e){return c(e)}))).subscribe(),function(){s.next(),s.complete()}}),[]),o.a.createElement("div",{className:"sl-quiz-comments-nav"},o.a.createElement("div",{onClick:function(){l.next({type:z.hideComments,requestType:"cancelable"})},className:"sl-quiz-comments-nav__hide"},o.a.createElement("span",null,"Hide"),o.a.createElement("div",{className:"sl-quiz-comments-nav__icon"},o.a.createElement(S.a,{iconId:"caret-down"}))),"number"==typeof n&&o.a.createElement("span",{className:"sl-quiz-comments-nav__count"},n," Comments"))})),_e=o.a.memo((function(){var e=a.b.take(I,Y).actions,t=a.b.take(I,F).selectedCommentId,n=function(e){e.stopPropagation(),a.b.take("global",a.c).close("SlCommentConfirmDelete")};return o.a.createElement("div",{className:"sl-comment-confirm-delete"},o.a.createElement("h4",{className:"sl-comment-confirm-delete__title"},"Delete Comment"),o.a.createElement("p",{className:"sl-comment-confirm-delete__question"},"Are you sure you want to delete this comment?"),o.a.createElement("div",{className:"sl-comment-confirm-delete__footer"},o.a.createElement("button",{className:"sl-comment-confirm-delete__button sl-comment-confirm-delete__button--cancel",onClick:n},"Cancel"),o.a.createElement("button",{className:"sl-comment-confirm-delete__button sl-comment-confirm-delete__button--delete",onClick:function(a){n(a),e.next({type:z.deleteComment,commentId:t.value,requestType:"parallel"})}},"Delete")))})),Ee=o.a.memo((function(e){var t=e.error,n=a.b.take(I,Y).actions;return o.a.createElement("div",{className:"sl-comment-global-error"},o.a.createElement("div",{className:"sl-comment-global-error__icon"},o.a.createElement(S.a,{iconId:"exclamation-rounded-fill"})),o.a.createElement("p",{className:"sl-comment-global-error__message"},t),o.a.createElement("button",{onClick:function(){n.next({type:z.getData,commentsCount:a.b.take(I,"commentsCount"),requestType:"cancelable"})},className:"sl-comment-global-error__button"},"Retry"))})),Oe=o.a.memo((function(){var e=Object(r.useRef)(null),t=Object(r.useState)(null),n=k(t,2),c=n[0],i=n[1],l=Object(r.useState)(null),s=k(l,2),u=s[0],p=s[1],f=Object(r.useState)(null),v=k(f,2),b=v[0],h=v[1],S=Object(r.useState)(!1),_=k(S,2),E=_[0],O=_[1],j=Object(r.useState)(null),x=k(j,2),w=x[0],q=x[1],N=a.b.take(I,Y).actions,T=a.b.take(I,F),Q=T.quizComments,A=T.postedComments,M=T.loadingState,D=T.hasMoreComments,R=T.globalError,L=[y.g.MostUpvoted,y.g.Recent],V=new m.a;return Object(r.useEffect)((function(){return R.pipe(Object(g.a)(V),Object(d.a)((function(e){return q(e)}))).subscribe(),D.pipe(Object(g.a)(V),Object(d.a)((function(e){return O(e)}))).subscribe(),M.pipe(Object(g.a)(V),Object(d.a)((function(e){return h(e.loadingState)}))).subscribe(),A.pipe(Object(g.a)(V),Object(d.a)((function(t){p(t),e.current.scrollIntoView()}))).subscribe(),Q.pipe(Object(g.a)(V),Object(d.a)((function(e){return i(e)}))).subscribe(),N.next({type:z.filterChange,filter:L[0],requestType:"cancelable"}),N.next({type:z.getData,commentsCount:a.b.take(I,"commentsCount"),requestType:"cancelable"}),function(){V.next(),V.complete()}}),[]),o.a.createElement("div",{className:"sl-quiz-comments-container"},o.a.createElement("div",{className:"sl-quiz-comments-container__header"},o.a.createElement("div",{className:"sl-quiz-comments-container__nav"},o.a.createElement(Se,null)),o.a.createElement("div",{className:"sl-quiz-comments-container__input"},o.a.createElement(te,null)),o.a.createElement("div",{className:"sl-quiz-comments-container__filters"},o.a.createElement(G,{filters:L,selectedFilter:L[0]}))),w?o.a.createElement("div",{className:"sl-quiz-comments-container__error"},o.a.createElement(Ee,{error:w})):o.a.createElement("div",{className:"sl-quiz-comments-container__body"},o.a.createElement("div",{ref:e},u&&u.length?o.a.createElement(Ce,{commentsType:"new",comments:u}):null),c&&c.length?o.a.createElement(Ce,{commentsType:"main",comments:c}):null,b?o.a.createElement("div",{className:"sl-quiz-comments-container__loader ".concat("global"===b?"sl-quiz-comments-container__loader--absolute":"")},o.a.createElement(C.g,{backgroundColor:"transparent"})):null,E?o.a.createElement(he,{parentId:null}):null),o.a.createElement(C.h,{id:"SlCommentConfirmDelete"},o.a.createElement(_e,null)))})),je=o.a.memo((function(e){var t=e.hideComments,n=e.configs,c=e.quizId,i=e.type,l=e.commentsCount,s=void 0===l?null:l,u=Object(r.useState)(!1),d=k(u,2),p=d[0],f=d[1],v=new m.a;return Object(r.useEffect)((function(){a.b.register(I,"hideComments",t),a.b.register(I,"quizId",c),a.b.register(I,"commentsApiHost",n.commentsApiHost),a.b.register(I,"useMock",n.useMock||!1),a.b.register(I,"commentsCount",s),a.b.register(I,"type",i),a.b.register(I,"mock",n.mock||null),f(!0);var e=a.b.take(I,R).trackActionStream,r=a.b.take(I,Y).actionsStream;return e.pipe(Object(g.a)(v)).subscribe(),r.pipe(Object(g.a)(v)).subscribe(),function(){v.next(),v.complete(),a.b.reset(I)}}),[]),o.a.createElement("div",{className:"sl-quiz-comments"},p&&o.a.createElement(Oe,null))}))}}]);